brown <- function(p, R, ...) {
   
   ### data frame for converting correlations to covariances
   brownCovs <- structure(list(rhos = c(-0.99, -0.98, -0.97, -0.96, -0.95, -0.94, -0.93, -0.92, -0.91, -0.9, -0.89, -0.88, -0.87, -0.86, -0.85, -0.84, -0.83, -0.82, -0.81, -0.8, -0.79, -0.78, -0.77, -0.76, -0.75, -0.74, -0.73, -0.72, -0.71, -0.7, -0.69, -0.68, -0.67, -0.66, -0.65, -0.64, -0.63, -0.62, -0.61, -0.6, -0.59, -0.58, -0.57, -0.56, -0.55, -0.54, -0.53, -0.52, -0.51, -0.5, -0.49, -0.48, -0.47, -0.46, -0.45, -0.44, -0.43, -0.42, -0.41, -0.4, -0.39, -0.38, -0.37, -0.36, -0.35, -0.34, -0.33, -0.32, -0.31, -0.3, -0.29, -0.28, -0.27, -0.26, -0.25, -0.24, -0.23, -0.22, -0.21, -0.2, -0.19, -0.18, -0.17, -0.16, -0.15, -0.14, -0.13, -0.12, -0.11, -0.1, -0.09, -0.08, -0.07, -0.06, -0.05, -0.04, -0.03, -0.02, -0.01, 0, 0.01, 0.02, 0.03, 0.04, 0.05, 0.06, 0.07, 0.08, 0.09, 0.1, 0.11, 0.12, 0.13, 0.14, 0.15, 0.16, 0.17, 0.18, 0.19, 0.2, 0.21, 0.22, 0.23, 0.24, 0.25, 0.26, 0.27, 0.28, 0.29, 0.3, 0.31, 0.32, 0.33, 0.34, 0.35, 0.36, 0.37, 0.38, 0.39, 0.4, 0.41, 0.42, 0.43, 0.44, 0.45, 0.46, 0.47, 0.48, 0.49, 0.5, 0.51, 0.52, 0.53, 0.54, 0.55, 0.56, 0.57, 0.58, 0.59, 0.6, 0.61, 0.62, 0.63, 0.64, 0.65, 0.66, 0.67, 0.68, 0.69, 0.7, 0.71, 0.72, 0.73, 0.74, 0.75, 0.76, 0.77, 0.78, 0.79, 0.8, 0.81, 0.82, 0.83, 0.84, 0.85, 0.86, 0.87, 0.88, 0.89, 0.9, 0.91, 0.92, 0.93, 0.94, 0.95, 0.96, 0.97, 0.98, 0.99, 1),
                               covs = c(-2.56045148673299, -2.54104008384837, -2.52150190779975, -2.50183681090819, -2.48204465308696, -2.46212534549982, -2.4420785352514, -2.42190428044009, -2.4016023676054, -2.38117264188949, -2.36061495691749, -2.33992916332478, -2.31911511084017, -2.29817265081379, -2.27710163522496, -2.2559019096076, -2.23457332347956, -2.21311573217268, -2.19152898281504, -2.16981292335523, -2.1479674070427, -2.1259922799203, -2.10388739120354, -2.08165258985254, -2.05928772637033, -2.03679264792765, -2.014167204559, -1.99141124349718, -1.96852461477882, -1.94550714609299, -1.92235872574369, -1.89907917807891, -1.87566837327772, -1.85212613538268, -1.82845229016421, -1.80464672522994, -1.78070927308072, -1.75663978350604, -1.73243810347288, -1.70810407890705, -1.68363756252723, -1.65903839150039, -1.63430641299024, -1.60944148708728, -1.58444344451003, -1.5593121429005, -1.53404742916455, -1.50864913789432, -1.4831171273886, -1.45745123950969, -1.43165131852771, -1.40571721527971, -1.37964876227736, -1.3534458271777, -1.32710824599673, -1.30063586120879, -1.27402851934594, -1.24728606867576, -1.220408351938, -1.19339521726278, -1.16624650138307, -1.13896206607104, -1.11154173899281, -1.08398537663392, -1.05629281544786, -1.02846390283087, -1.00049848779739, -0.972396409358578, -0.944157515606309, -0.915781670986068, -0.887268675747843, -0.858618396525626, -0.829830677244167, -0.800905360695499, -0.771842254241132, -0.742641316125032, -0.713302350232469, -0.683825012583989, -0.654209369899124, -0.624455194089158, -0.594562325567277, -0.564530619854667, -0.534359884699531, -0.504049998595955, -0.473600792743891, -0.443012103609121, -0.412283782774688, -0.381415671557864, -0.350407580010176, -0.319259432152712, -0.287970990009859, -0.256542122462894, -0.224972671038109, -0.193262477542549, -0.161411383054474, -0.129419228354849, -0.0972858561938201, -0.065011106146077, -0.0325948161376197, -3.68329841036186e-05, 0.032663005119093, 0.065504859586472, 0.0984888885793902, 0.131615267904243, 0.164884110436021, 0.198295622786191, 0.231849948904853, 0.26554725226146, 0.299387691546261, 0.333371430328994, 0.367498619929025, 0.401769434994278, 0.436184029853, 0.470742564246633, 0.505445200880321, 0.540292106180258, 0.575283437337244, 0.610419353337508, 0.645700022414926, 0.681125605537131, 0.716696265660212, 0.752412162825951, 0.788273461369549, 0.824280333450433, 0.860432953337492, 0.896731405195728, 0.933175933797282, 0.969766675311663, 1.0065038189819, 1.04338751111932, 1.08041789350343, 1.1175951739697, 1.15491948475633, 1.19239100022343, 1.23000988503633, 1.26777630603327, 1.30569043592761, 1.34375242392906, 1.38196243770326, 1.42032031220823, 1.4588272444918, 1.4974823641026, 1.53628618399537, 1.57523887033604, 1.61434058958519, 1.65359151148523, 1.69299180729622, 1.73254164094984, 1.77224117953993, 1.81209059489584, 1.85209005939179, 1.89223958571612, 1.93253985953078, 1.97299041521455, 2.01359177507938, 2.05434401608342, 2.09524731666736, 2.13630187754868, 2.17750785475144, 2.21886542681865, 2.26037475978826, 2.30203602426092, 2.34384939986843, 2.38581506361005, 2.42793318953834, 2.4702039574627, 2.5126275430342, 2.55520413304604, 2.59793389602682, 2.64081700196035, 2.6838536370144, 2.72704404375199, 2.77038833410596, 2.81388671678141, 2.85753938009803, 2.90134651990152, 2.94530831229958, 2.98942496189062, 3.03369664992675, 3.07812359333925, 3.12270597624785, 3.16744401641138, 3.21233791751701, 3.25738789143846, 3.30259415885804, 3.34795694782722, 3.39347648791165, 3.43915300277649, 3.48498681277004, 3.53097812894173, 3.57712726704221, 3.62343454712066, 3.66990033314139, 3.71652506345084, 3.76330924717781, 3.8102535765632, 3.85735905658701, 3.90462697827715, 3.94356499554494, 4)),
                          .Names = c("rhos", "covs"), row.names = c(NA, -200L), class = "data.frame")
   
   ### number of p-values
   m <- length(p)
   
   ### dimension checks
   if (!isSymmetric(R))
      stop("R is not symmetric.")
   
   if (nrow(R) != m)
      stop("Dimensions of R do not match length of p.")
   
   ### test statistic based on Fisher's method
   chi2val <- -2 * sum(log(p))
   
   ### lower triangular part of R
   r <- R[lower.tri(R)]
   
   ### round correlations to two decimals
   r <- round(r, 2)
   
   ### replace -1 correlations with -.99
   r[r == -1] <- -0.99
   
   ### convert correlations into covariances
   covs <- brownCovs[match(r, brownCovs$rho), 2]
   
   ### compute p-value based on Brown's method
   expx2 <- 2 * m
   varx2 <- 4 * m + 2 * sum(covs)
   fval <- 2 * expx2^2 / varx2
   cval <- varx2 / (2 * expx2)
   pval <- pchisq(chi2val/cval, df=fval, lower.tail=FALSE)
   
   return(pval)
}
